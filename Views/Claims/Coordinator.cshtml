@using Contract_Monthly_Claim_System.Models
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model List<Claim>
@{
    ViewData["Title"] = "Review Claims";
}

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-warning text-dark">
            <h4 class="mb-0"><i class="fas fa-tasks me-2"></i>Review Claims - Coordinator Dashboard</h4>
        </div>
        <div class="card-body">
            <!-- Statistics -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                            <h6>Total Claims</h6>
                            <h3>@Model.Count</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning">
                        <div class="card-body text-center">
                            <h6>Pending</h6>
                            <h3>@Model.Count(c => c.Status == "Pending")</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body text-center">
                            <h6>Approved</h6>
                            <h3>@Model.Count(c => c.Status == "Approved")</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                            <h6>Rejected</h6>
                            <h3>@Model.Count(c => c.Status == "Rejected")</h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Claims -->
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Pending Claims Requiring Action</h5>
                </div>
                <div class="card-body">
                    @if (!Model.Any(c => c.Status == "Pending"))
                    {
                            <div class="text-center py-4">
                                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                                <h5>No pending claims to review</h5>
                                <p class="text-muted">All claims have been processed.</p>
                            </div>
                    }
                    else
                    {
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Claim ID</th>
                                            <th>Lecturer</th>
                                            <th>Hours</th>
                                            <th>Rate</th>
                                            <th>Amount</th>
                                            <th>Date Submitted</th>
                                            <th>Notes</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    @foreach (var claim in Model.Where(c => c.Status == "Pending").OrderBy(c => c.DateSubmitted))
                                    {
                                                <tr>
                                                    <td><strong>#@claim.ClaimId</strong></td>
                                                    <td>@claim.LecturerName</td>
                                                    <td>@claim.HoursWorked hours</td>
                                                    <td>R @claim.HourlyRate</td>
                                                    <td><strong>R @claim.TotalAmount</strong></td>
                                                    <td>@claim.DateSubmitted.ToString("MMM dd, yyyy")</td>
                                                    <td>
                                                        <small class="text-muted">@(claim.Notes?.Length > 50 ? claim.Notes.Substring(0, 50) + "..." : claim.Notes)</small>
                                                    </td>
                                                    <td>
                                                        <div class="btn-group btn-group-sm">
                                                            <form asp-action="Approve" method="post" class="d-inline">
                                                                <input type="hidden" name="id" value="@claim.ClaimId" />
                                                                <button type="submit" class="btn btn-success" 
                                                                        onclick="return confirm('Approve claim #@claim.ClaimId for @claim.LecturerName?')">
                                                                    <i class="fas fa-check me-1"></i>Approve
                                                                </button>
                                                            </form>
                                                            <form asp-action="Reject" method="post" class="d-inline">
                                                                <input type="hidden" name="id" value="@claim.ClaimId" />
                                                                <button type="submit" class="btn btn-danger" 
                                                                        onclick="return confirm('Reject claim #@claim.ClaimId for @claim.LecturerName?')">
                                                                    <i class="fas fa-times me-1"></i>Reject
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </td>
                                                </tr>
                                    }
                                    </tbody>
                                </table>
                            </div>
                    }
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Activity</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Claim ID</th>
                                    <th>Lecturer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Action By</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var claim in Model.Where(c => c.Status != "Pending").OrderByDescending(c => c.DateApproved).Take(10))
                                {
                                        <tr>
                                            <td>#@claim.ClaimId</td>
                                            <td>@claim.LecturerName</td>
                                            <td>R @claim.TotalAmount</td>
                                            <td>
                                                <span class="badge @(claim.Status == "Approved" ? "bg-success" : "bg-danger")">
                                                @claim.Status
                                                </span>
                                            </td>
                                            <td>@claim.ApprovedBy</td>
                                            <td>@claim.DateApproved?.ToString("MMM dd, yyyy HH:mm")</td>
                                        </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>