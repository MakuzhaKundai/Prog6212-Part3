@using Contract_Monthly_Claim_System.Models
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

@model List<Claim>
@{
    ViewData["Title"] = "HR – Approved Claims";
}

<h2>HR – Approved Claims</h2>

<div class="card">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">Approved Claims Ready for Processing (@Model.Count)</h5>
    </div>
    <div class="card-body">
        @if (Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th>Claim ID</th>
                            <th>Lecturer</th>
                            <th>Hours</th>
                            <th>Rate</th>
                            <th>Total Amount</th>
                            <th>Date Approved</th>
                            <th>Approved By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var claim in Model)
                        {
                            <tr>
                                <td>#@claim.ClaimId</td>
                                <td>@claim.LecturerName</td>
                                <td>@claim.HoursWorked</td>
                                <td>R @claim.HourlyRate</td>
                                <td><strong>R @claim.TotalAmount</strong></td>
                                <td>@claim.DateApproved?.ToString("dd MMM yyyy HH:mm")</td>
                                <td>@claim.ApprovedBy</td>
                                <td>
                                    <a href="@Url.Action("GenerateInvoice", new { id = claim.ClaimId })"
                                       class="btn btn-primary btn-sm" target="_blank">
                                        📄 Generate Invoice
                                    </a>
                                    <a href="@Url.Action("Status", new { id = claim.ClaimId })"
                                       class="btn btn-info btn-sm">
                                        👁️ View Details
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mt-3 d-flex justify-content-between align-items-center">
                <div>
                    <a href="@Url.Action("GenerateBatchReport")"
                       class="btn btn-success" target="_blank">
                        📊 Generate Batch Payment Report
                    </a>
                </div>
                <div>
                    <strong class="h5">Total Payable: R @Model.Sum(c => c.TotalAmount)</strong>
                </div>
            </div>

            <div class="mt-3 alert alert-info">
                <small>
                    <strong>Note:</strong>
                    Invoice generation creates individual PDF invoices for each claim.
                    Batch report generates a comprehensive PDF with all approved claims for payment processing.
                </small>
            </div>
        }
        else
        {
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                No approved claims ready for processing.
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function viewDetails(claimId) {
            window.location.href = '@Url.Action("Status", "Claims")' + '?id=' + claimId;
        }
    </script>
}